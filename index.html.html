<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate To-Do List Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --dark: #1e1b4b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --bg-primary: #f1f5f9;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.05);
            --radius: 16px;
            --radius-sm: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-mode {
            --bg-primary: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --gray-light: #334155;
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        body {
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: var(--transition);
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation .bubble {
            position: absolute;
            border-radius: 50%;
            animation: float 15s infinite ease-in-out;
            opacity: 0.1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.1; }
            90% { opacity: 0.1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 20px 40px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .logo i {
            font-size: 2rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            justify-content: center;
            border-radius: 50%;
        }

        .btn-primary {
            background: white;
            color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 30px;
        }

        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .card-title i {
            color: var(--primary);
        }

        /* Categories */
        .category-list {
            list-style: none;
        }

        .category-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 4px;
        }

        .category-item:hover, .category-item.active {
            background: var(--primary);
            color: white;
        }

        .category-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        .category-item .count {
            margin-left: auto;
            background: rgba(255,255,255,0.2);
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .category-item:not(.active) .count {
            background: var(--gray-light);
            color: var(--gray);
        }

        /* Add Category */
        .add-category-form {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .add-category-form input {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .add-category-form input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Main Content */
        .main-content {
            min-height: calc(100vh - 200px);
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
        }

        .stat-card:nth-child(1)::before { background: var(--primary); }
        .stat-card:nth-child(2)::before { background: var(--success); }
        .stat-card:nth-child(3)::before { background: var(--warning); }
        .stat-card:nth-child(4)::before { background: var(--danger); }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 1.2rem;
        }

        .stat-card:nth-child(1) .stat-icon { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
        .stat-card:nth-child(2) .stat-icon { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .stat-card:nth-child(3) .stat-icon { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .stat-card:nth-child(4) .stat-icon { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Task Input Section */
        .task-input-section {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 30px;
        }

        .task-input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .task-input-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .task-form {
            display: grid;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .task-input-main {
            display: flex;
            gap: 16px;
        }

        .task-input-main input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 1rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .task-input-main input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .btn-add-task {
            padding: 16px 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-add-task:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        /* Advanced Options Toggle */
        .advanced-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .advanced-options {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-light);
        }

        .advanced-options.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Filter & Search Section */
        .filter-section {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-box i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--gray-light);
            background: var(--bg-primary);
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .filter-btn.active, .filter-btn:hover {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .sort-dropdown {
            padding: 10px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        /* Task List */
        .task-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .task-list-header h3 {
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-item {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .task-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .task-item.completed {
            opacity: 0.7;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: var(--gray);
        }

        .priority-indicator {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
        }

        .priority-high { background: var(--danger); }
        .priority-medium { background: var(--warning); }
        .priority-low { background: var(--success); }

        .task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray-light);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .task-checkbox:hover {
            border-color: var(--primary);
        }

        .task-checkbox.checked {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: transparent;
            color: white;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .task-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 0.8rem;
        }

        .task-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            background: var(--bg-primary);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .task-meta-item i {
            font-size: 0.75rem;
        }

        .task-meta-item.overdue {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .task-category-tag {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: var(--transition);
        }

        .task-item:hover .task-actions {
            opacity: 1;
        }

        .task-action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            background: var(--bg-primary);
            color: var(--text-secondary);
        }

        .task-action-btn:hover {
            transform: scale(1.1);
        }

        .task-action-btn.edit:hover {
            background: var(--info);
            color: white;
        }

        .task-action-btn.delete:hover {
            background: var(--danger);
            color: white;
        }

        .task-action-btn.star:hover,
        .task-action-btn.star.active {
            background: var(--warning);
            color: white;
        }

        /* Right Sidebar */
        .right-sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        /* Progress Card */
        .progress-card {
            text-align: center;
        }

        .progress-ring {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 10;
        }

        .progress-ring .bg {
            stroke: var(--gray-light);
        }

        .progress-ring .progress {
            stroke: url(#gradient);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .progress-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Calendar Widget */
        .calendar-widget {
            margin-top: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-nav button {
            width: 30px;
            height: 30px;
            border: none;
            background: var(--bg-primary);
            border-radius: 50%;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .calendar-nav button:hover {
            background: var(--primary);
            color: white;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            text-align: center;
        }

        .calendar-day-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
            padding: 8px 0;
            font-weight: 600;
        }

        .calendar-day {
            padding: 8px;
            font-size: 0.85rem;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-day:hover {
            background: var(--gray-light);
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
        }

        .calendar-day.has-task {
            position: relative;
        }

        .calendar-day.has-task::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--secondary);
            border-radius: 50%;
        }

        /* Recent Activity */
        .activity-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-light);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .activity-icon.add { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .activity-icon.complete { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
        .activity-icon.delete { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 0.85rem;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: var(--transition);
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-primary);
            border-radius: 50%;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--gray-light);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow);
            min-width: 300px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }
        .toast.info { border-left: 4px solid var(--info); }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--danger); }
        .toast.warning .toast-icon { color: var(--warning); }
        .toast.info .toast-icon { color: var(--info); }

        .toast-message {
            flex: 1;
            font-size: 0.9rem;
        }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            padding: 4px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state-icon {
            font-size: 4rem;
            color: var(--gray-light);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-state p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Keyboard Shortcuts */
        .shortcuts-list {
            display: grid;
            gap: 12px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shortcut-keys {
            display: flex;
            gap: 6px;
        }

        .key {
            background: var(--bg-primary);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            border: 1px solid var(--gray-light);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }

            .sidebar, .right-sidebar {
                position: static;
            }

            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .logo h1 {
                display: none;
            }

            .container {
                padding: 15px;
            }

            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .task-input-main {
                flex-direction: column;
            }

            .filter-section {
                flex-direction: column;
            }

            .filter-buttons {
                width: 100%;
                overflow-x: auto;
            }

            .task-item {
                padding: 16px;
            }

            .task-actions {
                opacity: 1;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray);
        }

        /* Color Picker */
        .color-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
        }

        .color-option:hover, .color-option.active {
            transform: scale(1.1);
            border-color: var(--text-primary);
        }

        /* Tags Input */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px;
            background: var(--bg-primary);
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            min-height: 50px;
        }

        .tag {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tag-remove {
            cursor: pointer;
            opacity: 0.7;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        .tags-input {
            border: none;
            outline: none;
            background: transparent;
            flex: 1;
            min-width: 100px;
            color: var(--text-primary);
        }

        /* Subtasks */
        .subtasks-list {
            margin-top: 12px;
            padding-left: 40px;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .subtask-checkbox {
            width: 18px;
            height: 18px;
        }

        /* Confetti Effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation" id="bgAnimation"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-check-circle"></i>
                <h1>TaskMaster Pro</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary btn-icon" id="themeToggle" title="Toggle Theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn btn-secondary btn-icon" id="shortcutsBtn" title="Keyboard Shortcuts">
                    <i class="fas fa-keyboard"></i>
                </button>
                <button class="btn btn-secondary" id="exportBtn">
                    <i class="fas fa-download"></i>
                    <span>Export</span>
                </button>
                <button class="btn btn-secondary" id="importBtn">
                    <i class="fas fa-upload"></i>
                    <span>Import</span>
                </button>
                <button class="btn btn-primary" id="clearCompletedBtn">
                    <i class="fas fa-broom"></i>
                    <span>Clear Completed</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <!-- Categories Card -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-folder"></i>
                    Categories
                </h3>
                <ul class="category-list" id="categoryList">
                    <li class="category-item active" data-category="all">
                        <i class="fas fa-inbox"></i>
                        All Tasks
                        <span class="count" id="allCount">0</span>
                    </li>
                    <li class="category-item" data-category="starred">
                        <i class="fas fa-star"></i>
                        Starred
                        <span class="count" id="starredCount">0</span>
                    </li>
                    <li class="category-item" data-category="today">
                        <i class="fas fa-calendar-day"></i>
                        Today
                        <span class="count" id="todayCount">0</span>
                    </li>
                    <li class="category-item" data-category="week">
                        <i class="fas fa-calendar-week"></i>
                        This Week
                        <span class="count" id="weekCount">0</span>
                    </li>
                </ul>
                <hr style="margin: 16px 0; border-color: var(--gray-light);">
                <ul class="category-list" id="customCategories"></ul>
                <div class="add-category-form">
                    <input type="text" id="newCategoryInput" placeholder="New category...">
                    <button class="btn btn-primary btn-icon" id="addCategoryBtn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>

            <!-- Priority Filter -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-flag"></i>
                    Priority Filter
                </h3>
                <ul class="category-list" id="priorityFilter">
                    <li class="category-item" data-priority="all">
                        <i class="fas fa-circle" style="color: var(--gray);"></i>
                        All Priorities
                    </li>
                    <li class="category-item" data-priority="high">
                        <i class="fas fa-circle" style="color: var(--danger);"></i>
                        High Priority
                    </li>
                    <li class="category-item" data-priority="medium">
                        <i class="fas fa-circle" style="color: var(--warning);"></i>
                        Medium Priority
                    </li>
                    <li class="category-item" data-priority="low">
                        <i class="fas fa-circle" style="color: var(--success);"></i>
                        Low Priority
                    </li>
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-number" id="pendingTasks">0</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-number" id="overdueTasks">0</div>
                    <div class="stat-label">Overdue</div>
                </div>
            </div>

            <!-- Task Input Section -->
            <div class="task-input-section">
                <div class="task-input-header">
                    <h2><i class="fas fa-plus-circle"></i> Add New Task</h2>
                </div>
                <form class="task-form" id="taskForm">
                    <div class="task-input-main">
                        <input type="text" id="taskTitle" placeholder="What do you need to do?" required>
                        <button type="submit" class="btn-add-task">
                            <i class="fas fa-plus"></i>
                            Add Task
                        </button>
                    </div>
                    <div class="advanced-toggle" id="advancedToggle">
                        <i class="fas fa-chevron-down"></i>
                        <span>Advanced Options</span>
                    </div>
                    <div class="advanced-options" id="advancedOptions">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="taskDescription" placeholder="Add more details..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select id="taskCategory">
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Priority</label>
                                <select id="taskPriority">
                                    <option value="low">Low Priority</option>
                                    <option value="medium" selected>Medium Priority</option>
                                    <option value="high">High Priority</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Due Date</label>
                                <input type="datetime-local" id="taskDueDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Tags (Press Enter to add)</label>
                            <div class="tags-container" id="tagsContainer">
                                <input type="text" class="tags-input" id="tagsInput" placeholder="Add tags...">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Subtasks</label>
                            <div id="subtasksContainer"></div>
                            <div class="add-category-form" style="margin-top: 8px;">
                                <input type="text" id="subtaskInput" placeholder="Add subtask...">
                                <button type="button" class="btn btn-primary btn-icon" id="addSubtaskBtn">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Filter & Search Section -->
            <div class="filter-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search tasks...">
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="active">Active</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>
                </div>
                <select class="sort-dropdown" id="sortSelect">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="priority">Priority</option>
                    <option value="dueDate">Due Date</option>
                    <option value="alphabetical">Alphabetical</option>
                </select>
            </div>

            <!-- Task List Header -->
            <div class="task-list-header">
                <h3 id="listTitle">All Tasks</h3>
                <div class="header-actions">
                    <button class="btn btn-icon" id="selectAllBtn" title="Select All">
                        <i class="fas fa-check-double"></i>
                    </button>
                    <button class="btn btn-icon" id="deleteSelectedBtn" title="Delete Selected">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>

            <!-- Task List -->
            <div class="task-list" id="taskList"></div>
        </main>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <!-- Progress Card -->
            <div class="card progress-card">
                <h3 class="card-title">
                    <i class="fas fa-chart-pie"></i>
                    Progress
                </h3>
                <div class="progress-ring">
                    <svg width="150" height="150">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#6366f1" />
                                <stop offset="100%" stop-color="#ec4899" />
                            </linearGradient>
                        </defs>
                        <circle class="bg" cx="75" cy="75" r="60"></circle>
                        <circle class="progress" cx="75" cy="75" r="60" 
                                stroke-dasharray="377" stroke-dashoffset="377" id="progressCircle"></circle>
                    </svg>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <p class="progress-label">Tasks Completed</p>
            </div>

            <!-- Calendar Widget -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-calendar-alt"></i>
                    <span id="calendarMonth">December 2024</span>
                </h3>
                <div class="calendar-nav" style="margin-bottom: 10px;">
                    <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                    <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-history"></i>
                    Recent Activity
                </h3>
                <div class="activity-list" id="activityList"></div>
            </div>

            <!-- Quick Stats -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    Quick Stats
                </h3>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Tasks Today</span>
                        <strong id="todayTasksStat">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Completed Today</span>
                        <strong id="completedTodayStat">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Streak</span>
                        <strong id="streakStat">0 days</strong>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Edit Task</h2>
                <button class="modal-close" id="closeEditModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editForm">
                <input type="hidden" id="editTaskId">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="editTitle" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editDescription"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="editCategory"></select>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="editPriority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="datetime-local" id="editDueDate">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" id="cancelEdit">Cancel</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Shortcuts Modal -->
    <div class="modal-overlay" id="shortcutsModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h2>
                <button class="modal-close" id="closeShortcutsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="shortcuts-list">
                <div class="shortcut-item">
                    <span>Add new task</span>
                    <div class="shortcut-keys">
                        <span class="key">Ctrl</span>
                        <span class="key">N</span>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span>Search tasks</span>
                    <div class="shortcut-keys">
                        <span class="key">Ctrl</span>
                        <span class="key">F</span>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span>Toggle dark mode</span>
                    <div class="shortcut-keys">
                        <span class="key">Ctrl</span>
                        <span class="key">D</span>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span>Clear completed</span>
                    <div class="shortcut-keys">
                        <span class="key">Ctrl</span>
                        <span class="key">Shift</span>
                        <span class="key">C</span>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span>Export tasks</span>
                    <div class="shortcut-keys">
                        <span class="key">Ctrl</span>
                        <span class="key">E</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Hidden file input for import -->
    <input type="file" id="importFile" accept=".json" style="display: none;">

    <script>
        // ============ DATA & STATE ============
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || ['Work', 'Personal', 'Shopping', 'Health', 'Study'];
        let activities = JSON.parse(localStorage.getItem('activities')) || [];
        let currentFilter = 'all';
        let currentCategory = 'all';
        let currentPriority = 'all';
        let searchQuery = '';
        let sortBy = 'newest';
        let tempTags = [];
        let tempSubtasks = [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // ============ DOM ELEMENTS ============
        const taskForm = document.getElementById('taskForm');
        const taskTitle = document.getElementById('taskTitle');
        const taskDescription = document.getElementById('taskDescription');
        const taskCategory = document.getElementById('taskCategory');
        const taskPriority = document.getElementById('taskPriority');
        const taskDueDate = document.getElementById('taskDueDate');
        const taskList = document.getElementById('taskList');
        const searchInput = document.getElementById('searchInput');
        const sortSelect = document.getElementById('sortSelect');
        const themeToggle = document.getElementById('themeToggle');
        const advancedToggle = document.getElementById('advancedToggle');
        const advancedOptions = document.getElementById('advancedOptions');
        const tagsInput = document.getElementById('tagsInput');
        const tagsContainer = document.getElementById('tagsContainer');
        const subtaskInput = document.getElementById('subtaskInput');
        const subtasksContainer = document.getElementById('subtasksContainer');

        // ============ INITIALIZATION ============
        function init() {
            loadTheme();
            renderCategories();
            renderTasks();
            updateStats();
            updateProgress();
            renderCalendar();
            renderActivities();
            createBubbles();
            setupEventListeners();
        }

        // ============ EVENT LISTENERS ============
        function setupEventListeners() {
            // Form submission
            taskForm.addEventListener('submit', handleAddTask);

            // Advanced options toggle
            advancedToggle.addEventListener('click', () => {
                advancedOptions.classList.toggle('show');
                advancedToggle.querySelector('i').classList.toggle('fa-chevron-down');
                advancedToggle.querySelector('i').classList.toggle('fa-chevron-up');
            });

            // Tags input
            tagsInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTag(tagsInput.value.trim());
                    tagsInput.value = '';
                }
            });

            // Add subtask
            document.getElementById('addSubtaskBtn').addEventListener('click', () => {
                if (subtaskInput.value.trim()) {
                    addSubtask(subtaskInput.value.trim());
                    subtaskInput.value = '';
                }
            });

            // Search
            searchInput.addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                renderTasks();
            });

            // Sort
            sortSelect.addEventListener('change', (e) => {
                sortBy = e.target.value;
                renderTasks();
            });

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderTasks();
                });
            });

            // Category selection
            document.getElementById('categoryList').addEventListener('click', (e) => {
                const item = e.target.closest('.category-item');
                if (item) {
                    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    currentCategory = item.dataset.category;
                    updateListTitle();
                    renderTasks();
                }
            });

            // Priority filter
            document.getElementById('priorityFilter').addEventListener('click', (e) => {
                const item = e.target.closest('.category-item');
                if (item) {
                    document.querySelectorAll('#priorityFilter .category-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    currentPriority = item.dataset.priority;
                    renderTasks();
                }
            });

            // Add category
            document.getElementById('addCategoryBtn').addEventListener('click', addCategory);
            document.getElementById('newCategoryInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') addCategory();
            });

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // Export/Import
            document.getElementById('exportBtn').addEventListener('click', exportTasks);
            document.getElementById('importBtn').addEventListener('click', () => document.getElementById('importFile').click());
            document.getElementById('importFile').addEventListener('change', importTasks);

            // Clear completed
            document.getElementById('clearCompletedBtn').addEventListener('click', clearCompleted);

            // Select all
            document.getElementById('selectAllBtn').addEventListener('click', selectAllTasks);

            // Modals
            document.getElementById('closeEditModal').addEventListener('click', () => closeModal('editModal'));
            document.getElementById('cancelEdit').addEventListener('click', () => closeModal('editModal'));
            document.getElementById('editForm').addEventListener('submit', handleEditTask);

            document.getElementById('shortcutsBtn').addEventListener('click', () => openModal('shortcutsModal'));
            document.getElementById('closeShortcutsModal').addEventListener('click', () => closeModal('shortcutsModal'));

            // Calendar navigation
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) { currentMonth = 11; currentYear--; }
                renderCalendar();
            });
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) { currentMonth = 0; currentYear++; }
                renderCalendar();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);

            // Click outside modal
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal(modal.id);
                });
            });
        }

        // ============ TASK FUNCTIONS ============
        function handleAddTask(e) {
            e.preventDefault();

            const task = {
                id: Date.now(),
                title: taskTitle.value.trim(),
                description: taskDescription.value.trim(),
                category: taskCategory.value,
                priority: taskPriority.value,
                dueDate: taskDueDate.value,
                tags: [...tempTags],
                subtasks: [...tempSubtasks],
                completed: false,
                starred: false,
                createdAt: new Date().toISOString()
            };

            tasks.unshift(task);
            saveTasks();
            addActivity('add', task.title);

            // Reset form
            taskForm.reset();
            tempTags = [];
            tempSubtasks = [];
            renderTags();
            renderSubtasks();
            advancedOptions.classList.remove('show');

            renderTasks();
            updateStats();
            updateProgress();
            showToast('Task added successfully!', 'success');
            playSound('add');
        }

        function toggleTaskComplete(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                saveTasks();
                addActivity(task.completed ? 'complete' : 'add', task.title);
                renderTasks();
                updateStats();
                updateProgress();
                
                if (task.completed) {
                    showToast('Task completed! ', 'success');
                    createConfetti();
                    playSound('complete');
                }
            }
        }

        function toggleTaskStar(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.starred = !task.starred;
                saveTasks();
                renderTasks();
                updateStats();
            }
        }

        function deleteTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task && confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== id);
                saveTasks();
                addActivity('delete', task.title);
                renderTasks();
                updateStats();
                updateProgress();
                showToast('Task deleted!', 'error');
                playSound('delete');
            }
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                document.getElementById('editTaskId').value = id;
                document.getElementById('editTitle').value = task.title;
                document.getElementById('editDescription').value = task.description || '';
                document.getElementById('editCategory').innerHTML = getCategoryOptions();
                document.getElementById('editCategory').value = task.category || '';
                document.getElementById('editPriority').value = task.priority;
                document.getElementById('editDueDate').value = task.dueDate || '';
                openModal('editModal');
            }
        }

        function handleEditTask(e) {
            e.preventDefault();
            const id = parseInt(document.getElementById('editTaskId').value);
            const task = tasks.find(t => t.id === id);
            
            if (task) {
                task.title = document.getElementById('editTitle').value;
                task.description = document.getElementById('editDescription').value;
                task.category = document.getElementById('editCategory').value;
                task.priority = document.getElementById('editPriority').value;
                task.dueDate = document.getElementById('editDueDate').value;
                
                saveTasks();
                renderTasks();
                closeModal('editModal');
                showToast('Task updated!', 'info');
            }
        }

        // ============ RENDER FUNCTIONS ============
        function renderTasks() {
            let filteredTasks = [...tasks];

            // Apply category filter
            if (currentCategory === 'starred') {
                filteredTasks = filteredTasks.filter(t => t.starred);
            } else if (currentCategory === 'today') {
                const today = new Date().toDateString();
                filteredTasks = filteredTasks.filter(t => t.dueDate && new Date(t.dueDate).toDateString() === today);
            } else if (currentCategory === 'week') {
                const now = new Date();
                const weekEnd = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
                filteredTasks = filteredTasks.filter(t => {
                    if (!t.dueDate) return false;
                    const dueDate = new Date(t.dueDate);
                    return dueDate >= now && dueDate <= weekEnd;
                });
            } else if (currentCategory !== 'all') {
                filteredTasks = filteredTasks.filter(t => t.category === currentCategory);
            }

            // Apply priority filter
            if (currentPriority !== 'all') {
                filteredTasks = filteredTasks.filter(t => t.priority === currentPriority);
            }

            // Apply status filter
            if (currentFilter === 'active') {
                filteredTasks = filteredTasks.filter(t => !t.completed);
            } else if (currentFilter === 'completed') {
                filteredTasks = filteredTasks.filter(t => t.completed);
            }

            // Apply search
            if (searchQuery) {
                filteredTasks = filteredTasks.filter(t => 
                    t.title.toLowerCase().includes(searchQuery) ||
                    (t.description && t.description.toLowerCase().includes(searchQuery)) ||
                    (t.tags && t.tags.some(tag => tag.toLowerCase().includes(searchQuery)))
                );
            }

            // Apply sort
            filteredTasks = sortTasks(filteredTasks);

            // Render
            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <h3>No tasks found</h3>
                        <p>Add a new task to get started!</p>
                    </div>
                `;
            } else {
                taskList.innerHTML = filteredTasks.map(task => createTaskHTML(task)).join('');
                setupDragAndDrop();
            }
        }

        function createTaskHTML(task) {
            const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && !task.completed;
            const formattedDate = task.dueDate ? formatDate(task.dueDate) : '';
            
            return `
                <div class="task-item ${task.completed ? 'completed' : ''}" data-id="${task.id}" draggable="true">
                    <div class="priority-indicator priority-${task.priority}"></div>
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTaskComplete(${task.id})">
                        ${task.completed ? '<i class="fas fa-check"></i>' : ''}
                    </div>
                    <div class="task-content">
                        <div class="task-title">${escapeHtml(task.title)}</div>
                        ${task.description ? `<div class="task-description">${escapeHtml(task.description)}</div>` : ''}
                        <div class="task-meta">
                            ${task.category ? `<span class="task-category-tag">${escapeHtml(task.category)}</span>` : ''}
                            ${formattedDate ? `
                                <span class="task-meta-item ${isOverdue ? 'overdue' : ''}">
                                    <i class="fas fa-calendar"></i>
                                    ${formattedDate}
                                </span>
                            ` : ''}
                            ${task.tags && task.tags.length > 0 ? task.tags.map(tag => `
                                <span class="task-meta-item">
                                    <i class="fas fa-tag"></i>
                                    ${escapeHtml(tag)}
                                </span>
                            `).join('') : ''}
                            ${task.subtasks && task.subtasks.length > 0 ? `
                                <span class="task-meta-item">
                                    <i class="fas fa-list"></i>
                                    ${task.subtasks.filter(s => s.completed).length}/${task.subtasks.length}
                                </span>
                            ` : ''}
                        </div>
                        ${task.subtasks && task.subtasks.length > 0 ? `
                            <div class="subtasks-list">
                                ${task.subtasks.map((subtask, index) => `
                                    <div class="subtask-item">
                                        <input type="checkbox" class="subtask-checkbox" 
                                            ${subtask.completed ? 'checked' : ''} 
                                            onchange="toggleSubtask(${task.id}, ${index})">
                                        <span style="${subtask.completed ? 'text-decoration: line-through;' : ''}">${escapeHtml(subtask.title)}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <div class="task-actions">
                        <button class="task-action-btn star ${task.starred ? 'active' : ''}" onclick="toggleTaskStar(${task.id})" title="Star">
                            <i class="fas fa-star"></i>
                        </button>
                        <button class="task-action-btn edit" onclick="editTask(${task.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="task-action-btn delete" onclick="deleteTask(${task.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderCategories() {
            const customCategoriesEl = document.getElementById('customCategories');
            customCategoriesEl.innerHTML = categories.map(cat => `
                <li class="category-item" data-category="${cat}">
                    <i class="fas fa-folder"></i>
                    ${escapeHtml(cat)}
                    <span class="count">${tasks.filter(t => t.category === cat).length}</span>
                </li>
            `).join('');

            // Update category select
            taskCategory.innerHTML = getCategoryOptions();
        }

        function getCategoryOptions() {
            return `<option value="">Select Category</option>` + 
                categories.map(cat => `<option value="${cat}">${escapeHtml(cat)}</option>`).join('');
        }

        function renderTags() {
            const existingTags = tagsContainer.querySelectorAll('.tag');
            existingTags.forEach(t => t.remove());
            
            tempTags.forEach((tag, index) => {
                const tagEl = document.createElement('span');
                tagEl.className = 'tag';
                tagEl.innerHTML = `${escapeHtml(tag)} <span class="tag-remove" onclick="removeTag(${index})"></span>`;
                tagsContainer.insertBefore(tagEl, tagsInput);
            });
        }

        function renderSubtasks() {
            subtasksContainer.innerHTML = tempSubtasks.map((subtask, index) => `
                <div class="subtask-item">
                    <input type="checkbox" ${subtask.completed ? 'checked' : ''} onchange="toggleTempSubtask(${index})">
                    <span>${escapeHtml(subtask.title)}</span>
                    <button type="button" onclick="removeTempSubtask(${index})" style="margin-left: auto; background: none; border: none; color: var(--danger); cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function renderCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            const dayNames = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];
            
            document.getElementById('calendarMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = new Date();
            
            let html = dayNames.map(d => `<div class="calendar-day-name">${d}</div>`).join('');
            
            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day"></div>';
            }
            
            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const isToday = date.toDateString() === today.toDateString();
                const hasTask = tasks.some(t => t.dueDate && new Date(t.dueDate).toDateString() === date.toDateString());
                
                html += `<div class="calendar-day ${isToday ? 'today' : ''} ${hasTask ? 'has-task' : ''}">${day}</div>`;
            }
            
            document.getElementById('calendarGrid').innerHTML = html;
        }

        function renderActivities() {
            const activityList = document.getElementById('activityList');
            const recentActivities = activities.slice(0, 10);
            
            if (recentActivities.length === 0) {
                activityList.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No recent activity</p>';
                return;
            }
            
            activityList.innerHTML = recentActivities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon ${activity.type}">
                        <i class="fas fa-${activity.type === 'add' ? 'plus' : activity.type === 'complete' ? 'check' : 'trash'}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-text">${getActivityText(activity)}</div>
                        <div class="activity-time">${formatTimeAgo(activity.timestamp)}</div>
                    </div>
                </div>
            `).join('');
        }

        // ============ STATS & PROGRESS ============
        function updateStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = total - completed;
            const overdue = tasks.filter(t => 
                t.dueDate && new Date(t.dueDate) < new Date() && !t.completed
            ).length;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('pendingTasks').textContent = pending;
            document.getElementById('overdueTasks').textContent = overdue;

            // Update counts
            document.getElementById('allCount').textContent = total;
            document.getElementById('starredCount').textContent = tasks.filter(t => t.starred).length;
            
            const today = new Date().toDateString();
            document.getElementById('todayCount').textContent = tasks.filter(t => 
                t.dueDate && new Date(t.dueDate).toDateString() === today
            ).length;

            const now = new Date();
            const weekEnd = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            document.getElementById('weekCount').textContent = tasks.filter(t => {
                if (!t.dueDate) return false;
                const dueDate = new Date(t.dueDate);
                return dueDate >= now && dueDate <= weekEnd;
            }).length;

            // Quick stats
            document.getElementById('todayTasksStat').textContent = tasks.filter(t => 
                new Date(t.createdAt).toDateString() === today
            ).length;
            document.getElementById('completedTodayStat').textContent = tasks.filter(t => 
                t.completed && new Date(t.createdAt).toDateString() === today
            ).length;

            renderCategories();
        }

        function updateProgress() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 60;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            document.getElementById('progressText').textContent = `${percentage}%`;
        }

        // ============ UTILITY FUNCTIONS ============
        function sortTasks(tasksToSort) {
            return tasksToSort.sort((a, b) => {
                switch (sortBy) {
                    case 'oldest':
                        return new Date(a.createdAt) - new Date(b.createdAt);
                    case 'priority':
                        const priorityOrder = { high: 0, medium: 1, low: 2 };
                        return priorityOrder[a.priority] - priorityOrder[b.priority];
                    case 'dueDate':
                        if (!a.dueDate) return 1;
                        if (!b.dueDate) return -1;
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    case 'alphabetical':
                        return a.title.localeCompare(b.title);
                    default: // newest
                        return new Date(b.createdAt) - new Date(a.createdAt);
                }
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = date - now;
            
            if (diff < 0 && diff > -86400000) return 'Overdue';
            if (diff > 0 && diff < 86400000) return 'Today';
            if (diff > 86400000 && diff < 172800000) return 'Tomorrow';
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatTimeAgo(timestamp) {
            const now = new Date();
            const date = new Date(timestamp);
            const diff = Math.floor((now - date) / 1000);
            
            if (diff < 60) return 'Just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return `${Math.floor(diff / 86400)}d ago`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function saveCategories() {
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        function saveActivities() {
            localStorage.setItem('activities', JSON.stringify(activities.slice(0, 50)));
        }

        // ============ CATEGORY FUNCTIONS ============
        function addCategory() {
            const input = document.getElementById('newCategoryInput');
            const name = input.value.trim();
            
            if (name && !categories.includes(name)) {
                categories.push(name);
                saveCategories();
                renderCategories();
                input.value = '';
                showToast(`Category "${name}" added!`, 'success');
            }
        }

        // ============ TAG FUNCTIONS ============
        function addTag(tag) {
            if (tag && !tempTags.includes(tag)) {
                tempTags.push(tag);
                renderTags();
            }
        }

        function removeTag(index) {
            tempTags.splice(index, 1);
            renderTags();
        }

        // ============ SUBTASK FUNCTIONS ============
        function addSubtask(title) {
            tempSubtasks.push({ title, completed: false });
            renderSubtasks();
        }

        function toggleTempSubtask(index) {
            tempSubtasks[index].completed = !tempSubtasks[index].completed;
            renderSubtasks();
        }

        function removeTempSubtask(index) {
            tempSubtasks.splice(index, 1);
            renderSubtasks();
        }

        function toggleSubtask(taskId, subtaskIndex) {
            const task = tasks.find(t => t.id === taskId);
            if (task && task.subtasks[subtaskIndex]) {
                task.subtasks[subtaskIndex].completed = !task.subtasks[subtaskIndex].completed;
                saveTasks();
                renderTasks();
            }
        }

        // ============ ACTIVITY FUNCTIONS ============
        function addActivity(type, taskTitle) {
            activities.unshift({
                type,
                taskTitle,
                timestamp: new Date().toISOString()
            });
            saveActivities();
            renderActivities();
        }

        function getActivityText(activity) {
            switch (activity.type) {
                case 'add':
                    return `Added "${activity.taskTitle}"`;
                case 'complete':
                    return `Completed "${activity.taskTitle}"`;
                case 'delete':
                    return `Deleted "${activity.taskTitle}"`;
                default:
                    return activity.taskTitle;
            }
        }

        // ============ THEME FUNCTIONS ============
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        }

        function loadTheme() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        // ============ MODAL FUNCTIONS ============
        function openModal(id) {
            document.getElementById(id).classList.add('show');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        // ============ EXPORT/IMPORT ============
        function exportTasks() {
            const data = {
                tasks,
                categories,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tasks-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Tasks exported successfully!', 'success');
        }

        function importTasks(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    if (data.tasks) {
                        tasks = [...tasks, ...data.tasks];
                        saveTasks();
                    }
                    if (data.categories) {
                        categories = [...new Set([...categories, ...data.categories])];
                        saveCategories();
                    }
                    renderTasks();
                    renderCategories();
                    updateStats();
                    updateProgress();
                    showToast('Tasks imported successfully!', 'success');
                } catch (error) {
                    showToast('Failed to import tasks!', 'error');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        // ============ OTHER ACTIONS ============
        function clearCompleted() {
            const completedCount = tasks.filter(t => t.completed).length;
            if (completedCount === 0) {
                showToast('No completed tasks to clear!', 'warning');
                return;
            }
            
            if (confirm(`Delete ${completedCount} completed task(s)?`)) {
                tasks = tasks.filter(t => !t.completed);
                saveTasks();
                renderTasks();
                updateStats();
                updateProgress();
                showToast(`${completedCount} completed task(s) cleared!`, 'success');
            }
        }

        function selectAllTasks() {
            const allCompleted = tasks.every(t => t.completed);
            tasks.forEach(t => t.completed = !allCompleted);
            saveTasks();
            renderTasks();
            updateStats();
            updateProgress();
        }

        function updateListTitle() {
            const titles = {
                all: 'All Tasks',
                starred: 'Starred Tasks',
                today: "Today's Tasks",
                week: 'This Week'
            };
            document.getElementById('listTitle').textContent = titles[currentCategory] || currentCategory;
        }

        // ============ DRAG AND DROP ============
        function setupDragAndDrop() {
            const items = document.querySelectorAll('.task-item');
            
            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    item.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', item.dataset.id);
                });
                
                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging');
                });
                
                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const dragging = document.querySelector('.dragging');
                    if (dragging !== item) {
                        const box = item.getBoundingClientRect();
                        const offset = e.clientY - box.top - box.height / 2;
                        if (offset < 0) {
                            taskList.insertBefore(dragging, item);
                        } else {
                            taskList.insertBefore(dragging, item.nextSibling);
                        }
                    }
                });
            });
        }

        // ============ KEYBOARD SHORTCUTS ============
        function handleKeyboardShortcuts(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key.toLowerCase()) {
                    case 'n':
                        e.preventDefault();
                        taskTitle.focus();
                        break;
                    case 'f':
                        e.preventDefault();
                        searchInput.focus();
                        break;
                    case 'd':
                        e.preventDefault();
                        toggleTheme();
                        break;
                    case 'e':
                        e.preventDefault();
                        exportTasks();
                        break;
                }
                
                if (e.shiftKey && e.key.toLowerCase() === 'c') {
                    e.preventDefault();
                    clearCompleted();
                }
            }
        }

        // ============ TOAST NOTIFICATIONS ============
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'check-circle',
                error: 'times-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            
            toast.innerHTML = `
                <i class="fas fa-${icons[type]} toast-icon"></i>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============ SOUND EFFECTS ============
        function playSound(type) {
            // Create audio context for sound effects
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            const sounds = {
                add: { freq: 800, duration: 0.1 },
                complete: { freq: 1200, duration: 0.15 },
                delete: { freq: 300, duration: 0.1 }
            };
            
            const sound = sounds[type] || sounds.add;
            oscillator.frequency.value = sound.freq;
            gainNode.gain.value = 0.1;
            
            oscillator.start();
            setTimeout(() => oscillator.stop(), sound.duration * 1000);
        }

        // ============ CONFETTI EFFECT ============
        function createConfetti() {
            const colors = ['#6366f1', '#ec4899', '#10b981', '#f59e0b', '#3b82f6'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = confetti.style.width;
                
                document.body.appendChild(confetti);
                
                const animation = confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], {
                    duration: Math.random() * 2000 + 1000,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                });
                
                animation.onfinish = () => confetti.remove();
            }
        }

        // ============ BACKGROUND BUBBLES ============
        function createBubbles() {
            const colors = ['#6366f1', '#ec4899', '#10b981', '#f59e0b'];
            const container = document.getElementById('bgAnimation');
            
            for (let i = 0; i < 20; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.style.width = Math.random() * 100 + 50 + 'px';
                bubble.style.height = bubble.style.width;
                bubble.style.left = Math.random() * 100 + '%';
                bubble.style.background = colors[Math.floor(Math.random() * colors.length)];
                bubble.style.animationDelay = Math.random() * 15 + 's';
                bubble.style.animationDuration = Math.random() * 10 + 10 + 's';
                container.appendChild(bubble);
            }
        }

        // Initialize the app
        init();
    </script>
</body>
</html>